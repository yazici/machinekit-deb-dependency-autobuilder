A Makefile and pbuilderrc to automatically build Xenomai kernel
packages for many Debian/Ubuntu release and architecture combinations

---------------------------
Prerequisites:

The pbuilder, reprepro and quilt packages must be installed, in
addition to the usual kernel development environment.

    apt-get install pbuilder reprepro

---------------------------
Restricting build list:

NOTE: It is advised to trim the build list to save build time, even if
explicitly supplying a <codename>/<arch> target.

If only a subset of codenames or arches is needed, restrict them by
trimming the 'CODENAMES' and 'ARCHES' variables in the Makefile.

For example, to build only Wheezy and Jessie amd64 kernels:

    ARCHES = amd64               # i386 removed
    CODENAMES = wheezy jessie    # precise removed

---------------------------
Targets:

all:  (Default target)  Build all <codename>/<arch> combos

clean:  Clean up all targets that can be easily regenerated

squeaky-clean:  Clean up all targets, including downloaded tarballs,
    git submodules, apt and C caches; in general, avoid this!

<codename>/<arch>/all:  e.g. wheezy/i386/all
    Build all packages and PPA for the specified distro and architecture

<codename>/<arch>/chroot:  e.g. jessie/amd64/chroot
    Set up and log into a chroot

<codename>/<arch>/clean:
    Remove build artifacts specific to that codename/arch; leave
    common artifacts

Codename is one of wheezy, jessie, precise

Arch is one of amd64, i386

Most simply, just run 'make' to build all packages for all
<codename>/<arch> combos.

To pass in options to dpkg-buildpackage, use e.g.

    make DEBBUILDOPTS=-j16

---------------------------
What it does

For each <codename>/<arch> combo:
- Downloads sources, checks out git repos, builds gpg keyring
- Creates a base pbuilder chroot tarball
- Builds the Xenomai runtime packages
- Builds a local PPA with the Xenomai runtime packages, needed for the
  kernel build
- Updates the pbuilder chroot tarball with the new PPA
- Builds the Xenomai kernel package
- Builds the linux-tools package
- Updates the local PPA with all packages

Package results go into <codename>/<arch>/pkgs.

PPAs go into <codename>/<arch>/ppa.

---------------------------
TODO

- build smictrl packages


---------------------------
Links

http://wiki.debian.org/Debootstrap

https://wiki.ubuntu.com/PbuilderHowto

http://wiki.debian.org/PbuilderTricks

http://manpages.ubuntu.com/manpages/intrepid/man1/pbuilder-dist.1.html

http://en.wikipedia.org/wiki/Debian_build_toolchain


---------------------------
Random notes follow

multiple releases in a single ppa
http://bobthegnome.blogspot.com/2012/12/a-script-for-supporting-multiple-ubuntu.html


# build smictrl
git clone git://git.kiszka.org/smictrl.git && cd smictrl
git clone git://github.com/zultron/smictrl-deb.git debian
dpkg-buildpackage -uc -us && cd ..
